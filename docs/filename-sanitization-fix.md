# Исправление проблемы с названиями файлов

## Проблема
При загрузке файлов с кириллическими названиями возникала ошибка:
```
Invalid key: c4f265c7-a823-40e4-9946-edbf2c904c8a/presentation/1753192916732-Шаблон_списка_ТП.xlsx
```

## Причина
Supabase Storage не поддерживает кириллические символы, пробелы и другие специальные символы в ключах файлов.

## Решение

### 1. Добавлена функция очистки названий файлов
В файле `src/lib/eventFileStorage.ts` добавлена функция `sanitizeFileName`:

```typescript
export const sanitizeFileName = (fileName: string): string => {
  return fileName
    .replace(/[^a-zA-Z0-9\-_]/g, '_') // Заменяем все недопустимые символы на подчеркивание
    .replace(/_+/g, '_') // Заменяем множественные подчеркивания на одно
    .replace(/^_|_$/g, '') // Убираем подчеркивания в начале и конце
    .substring(0, 100); // Ограничиваем длину
};
```

### 2. Обновлена функция загрузки файлов
Функция `uploadEventFile` теперь использует очищенное название файла для создания ключа в Storage, но сохраняет оригинальное название в метаданных.

### 3. Примеры преобразования названий

| Оригинальное название | Очищенное название |
|----------------------|-------------------|
| `Шаблон списка ТП.xlsx` | `1753192916732-Shablon_spiska_TP.xlsx` |
| `Презентация 2024.pptx` | `1753192916732-Prezentaciya_2024.pptx` |
| `Рабочая тетрадь.pdf` | `1753192916732-Rabochaya_tetrad.pdf` |

## Как это работает

1. **Пользователь загружает файл** с любым названием (включая кириллицу)
2. **Система очищает название** для использования в Storage
3. **Файл сохраняется** с очищенным названием в Storage
4. **Оригинальное название** сохраняется в метаданных для отображения пользователю
5. **Пользователь видит** оригинальное название в интерфейсе

## Преимущества

- ✅ Поддержка любых названий файлов
- ✅ Совместимость с Supabase Storage
- ✅ Сохранение пользовательских названий
- ✅ Автоматическая очистка без потери данных

## Технические детали

### Допустимые символы
- Латинские буквы (a-z, A-Z)
- Цифры (0-9)
- Дефис (-)
- Подчеркивание (_)

### Ограничения
- Максимальная длина очищенного названия: 100 символов
- Все недопустимые символы заменяются на подчеркивание
- Множественные подчеркивания заменяются на одно 