# Добавление тестов "Управление территорией для развития АКБ"

## Описание
Создана полная система тестирования для мероприятия "Управление территорией для развития АКБ":

### Мероприятие
- **Название**: "Управление территорией для развития АКБ"
- **Тип**: Очный тренинг
- **Описание**: Комплексное обучение управлению территорией и развитию агентской клиентской базы
- **Автоматическое назначение тестов**: Да

### Тесты
1. **Входной тест** - с 10 вопросами с вариантами ответов (включая "Затрудняюсь ответить")
2. **Итоговый тест** - с 10 открытыми вопросами для самостоятельных ответов
3. **Годовой тест** - с 10 вопросами с вариантами ответов (без "Затрудняюсь ответить")

## Структура тестов

### Входной тест
- **Название**: "Входной тест 'Управление территорией для развития АКБ'"
- **Тип**: entry (входной)
- **Проходной балл**: 70%
- **Время выполнения**: 30 минут
- **Количество вопросов**: 10
- **Тип вопросов**: single_choice (выбор одного варианта)

### Итоговый тест
- **Название**: "Итоговый тест 'Управление территорией для развития АКБ'"
- **Тип**: final (итоговый)
- **Проходной балл**: 70%
- **Время выполнения**: 60 минут
- **Количество вопросов**: 10
- **Тип вопросов**: text (открытые ответы)
- **Проверка**: вручную тренером

### Годовой тест
- **Название**: "Годовой тест 'Управление территорией для развития АКБ'"
- **Тип**: annual (годовой)
- **Проходной балл**: 75%
- **Время выполнения**: 45 минут
- **Количество вопросов**: 10
- **Тип вопросов**: single_choice (выбор одного варианта)
- **Особенность**: без варианта "Затрудняюсь ответить"

## Вопросы теста

1. **Какая самая частая причина возникновения возражений при продаже?**
   - Правильный ответ: "У ЛПР не сформировано доверие к предложению ТП"

2. **Какие преимущества дает ТП соблюдение технологии продаж «8 этапов визита в ТТ»?**
   - Правильный ответ: "Технология – это самый простой способ достижения результата продаж"

3. **Расчет прибыли от продажи E-ON по акции «10+6»**
   - Правильный ответ: "44,37 р."

4. **Проблемы при отсутствии анализа итогов визита**
   - Правильный ответ: "ТП теряет продажи дня и бонусы в конце месяца"

5. **Правила составления маршрута**
   - Правильный ответ: "Все варианты верные"

6. **Тактика планирования в начале месяца**
   - Правильный ответ: "Разделить план месяца на 4 недели и увеличить объем продаж на 20% в первые две недели месяца"

7. **Конкуренция с сетевым магазином**
   - Правильный ответ: "Предложить ЛПР размещение ДМП и участие в полочных программах СНС"

8. **Работа с высоко объемными ТТ**
   - Правильный ответ: "Предлагать премиальную продукцию, размещение ДМП и холодильного оборудования"

9. **Работа с низко объемными ТТ**
   - Правильный ответ: "Предлагать самые ходовые виды продукции и самые выгодные акции"

10. **Усиление этапа при возражении "товар не продается"**
    - Правильный ответ: "Мерчандайзинг"

## Вопросы итогового теста (открытые ответы)

1. **Анализ территории** (10 баллов)
   - Опишите, как вы будете анализировать свою территорию для выявления новых возможностей развития АКБ. Какие критерии и методы используете?

2. **Планирование маршрута** (10 баллов)
   - Составьте план маршрута на неделю для территории с 15 торговыми точками. Объясните принципы группировки ТТ и приоритизации визитов.

3. **Работа с возражениями** (10 баллов)
   - Опишите алгоритм работы с возражением "У нас нет места для вашего товара". Приведите конкретные аргументы и техники убеждения.

4. **Развитие клиентской базы** (10 баллов)
   - Как вы будете развивать клиентскую базу на своей территории? Опишите стратегию привлечения новых клиентов и удержания существующих.

5. **Анализ конкурентов** (10 баллов)
   - Опишите, как вы будете анализировать конкурентную среду на своей территории. Какие данные собираете и как используете для повышения продаж?

6. **Работа с разными типами ТТ** (10 баллов)
   - Опишите различия в подходе к работе с крупными сетевыми магазинами и небольшими торговыми точками. Какие стратегии применяете для каждого типа?

7. **Мотивация и стимулирование** (10 баллов)
   - Как вы будете мотивировать торговых представителей на своей территории для достижения плановых показателей? Опишите систему стимулирования.

8. **Контроль и отчетность** (10 баллов)
   - Опишите систему контроля и отчетности по территории. Какие KPI отслеживаете и как анализируете результаты?

9. **Решение проблем** (10 баллов)
   - Опишите, как вы будете решать конфликтные ситуации с клиентами на территории. Приведите примеры и алгоритм действий.

10. **Стратегия развития** (10 баллов)
    - Разработайте стратегию развития территории на следующие 6 месяцев. Включите цели, задачи, методы достижения и ожидаемые результаты.

## Применение миграции

### Вариант 1: Через Supabase Dashboard
1. Откройте Supabase Dashboard
2. Перейдите в раздел SQL Editor
3. Выполните миграции в следующем порядке:
   - `supabase/migrations/20250115000000_add_akb_territory_test.sql` - входной тест
   - `supabase/migrations/20250115000001_add_akb_final_test.sql` - итоговый тест
   - `supabase/migrations/20250115000002_add_akb_annual_test.sql` - годовой тест
   - `supabase/migrations/20250115000003_create_akb_event_fixed.sql` - мероприятие и автоматизация (ИСПРАВЛЕННАЯ ВЕРСИЯ)

**Важно**: Используйте исправленную версию `20250115000003_create_akb_event_fixed.sql`, которая содержит правильный статус `'published'` вместо `'active'`.

### Вариант 2: Через CLI
```bash
# Применить миграцию
supabase db push

# Или выполнить конкретную миграцию
supabase db reset
```

### Вариант 3: Прямое выполнение
```bash
# Выполнить SQL-скрипт напрямую
psql -h your-host -U postgres -d your-database -f scripts/add_akb_territory_test.sql
```

## Проверка результата

После применения миграции проверьте:

1. **Тест создан**:
```sql
SELECT * FROM tests WHERE title LIKE '%Управление территорией для развития АКБ%';
```

2. **Вопросы добавлены**:
```sql
SELECT COUNT(*) FROM test_questions tq
JOIN tests t ON tq.test_id = t.id
WHERE t.title LIKE '%Управление территорией для развития АКБ%';
```

3. **Ответы добавлены**:
```sql
SELECT COUNT(*) FROM test_answers ta
JOIN test_questions tq ON ta.question_id = tq.id
JOIN tests t ON tq.test_id = t.id
WHERE t.title LIKE '%Управление территорией для развития АКБ%';
```

## Файлы
- `supabase/migrations/20250115000000_add_akb_territory_test.sql` - миграция входного теста
- `supabase/migrations/20250115000001_add_akb_final_test.sql` - миграция итогового теста
- `supabase/migrations/20250115000002_add_akb_annual_test.sql` - миграция годового теста
- `supabase/migrations/20250115000003_create_akb_event_fixed.sql` - создание мероприятия и автоматизация (ИСПРАВЛЕННАЯ ВЕРСИЯ)
- `scripts/add_akb_territory_test.sql` - SQL-скрипт входного теста
- `scripts/add_akb_final_test.sql` - SQL-скрипт итогового теста
- `scripts/add_akb_annual_test.sql` - SQL-скрипт годового теста
- `docs/akb-territory-test-setup.md` - данная инструкция

## Автоматизация
После применения миграций система автоматически:
1. **Создает мероприятие** "Управление территорией для развития АКБ"
2. **Назначает тесты** при создании нового мероприятия с таким названием
3. **Назначает тесты участникам** при их добавлении к мероприятию
4. **Логирует действия** в admin_logs для отслеживания
