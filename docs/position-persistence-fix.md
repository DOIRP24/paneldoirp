# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ç–µ—Å—Ç–∞—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–∑–∏—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ø–∞–¥–∞–ª –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å, –∞ –Ω–µ –Ω–∞ —Ç–æ—Ç, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è.

## –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `current_question_index` –≤ —Ç–∞–±–ª–∏—Ü—É `user_test_attempts`:

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–∞ –≤ –ø–æ–ø—ã—Ç–∫–µ —Ç–µ—Å—Ç–∞
ALTER TABLE user_test_attempts 
ADD COLUMN current_question_index INTEGER DEFAULT 0;

-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ–ª—é
COMMENT ON COLUMN user_test_attempts.current_question_index IS '–ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (0-based)';

-- –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏
UPDATE user_test_attempts 
SET current_question_index = 0 
WHERE current_question_index IS NULL;
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å TestAttempt

```typescript
interface TestAttempt {
  id: string;
  test_id: string;
  user_id: string;
  event_id: string;
  started_at: string;
  completed_at?: string;
  score?: number;
  max_score?: number;
  passed?: boolean;
  current_question_index?: number; // –ù–æ–≤–æ–µ –ø–æ–ª–µ
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏

–í —Ö—É–∫ `useMobileTest` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `saveCurrentPosition`:

```typescript
// Save current question position
const saveCurrentPosition = useCallback(async (questionIndex: number) => {
  try {
    const { error } = await supabase
      .from('user_test_attempts')
      .update({ current_question_index: questionIndex })
      .eq('id', attemptId);

    if (error) throw error;
  } catch (err) {
    console.error('Error saving current position:', err);
  }
}, [attemptId]);
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

#### –ë—ã–ª–æ:
```typescript
const restoreProgress = () => {
  setShowRestoreModal(false);
  // Find last answered question
  const lastAnswered = questionProgress.reduce((max, item, index) => {
    return item.answered ? index : max;
  }, -1);
  // If no questions answered, start from 0, otherwise go to last answered + 1
  setCurrentQuestionIndex(lastAnswered >= 0 ? lastAnswered + 1 : 0);
};
```

#### –°—Ç–∞–ª–æ:
```typescript
const restoreProgress = () => {
  setShowRestoreModal(false);
  // Use saved position from database, or find last answered question
  const savedPosition = attempt?.current_question_index ?? 0;
  const lastAnswered = questionProgress.reduce((max, item, index) => {
    return item.answered ? index : max;
  }, -1);
  
  // Use saved position if it's valid, otherwise use last answered + 1
  const targetPosition = (savedPosition ?? 0) > 0 ? (savedPosition ?? 0) : (lastAnswered >= 0 ? lastAnswered + 1 : 0);
  setCurrentQuestionIndex(Math.min(targetPosition, questions.length - 1));
};
```

### 5. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏:

```typescript
const handleNext = () => {
  if (currentQuestionIndex < questions.length - 1) {
    const newIndex = currentQuestionIndex + 1;
    setCurrentQuestionIndex(newIndex);
    saveCurrentPosition(newIndex); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
  }
};

const handlePrevious = () => {
  if (currentQuestionIndex > 0) {
    const newIndex = currentQuestionIndex - 1;
    setCurrentQuestionIndex(newIndex);
    saveCurrentPosition(newIndex); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
  }
};

const handleQuestionSelect = (index: number) => {
  setCurrentQuestionIndex(index);
  setShowQuestionMenu(false);
  saveCurrentPosition(index); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
};
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏:
1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è** - –µ—Å–ª–∏ –≤ –ë–î –µ—Å—Ç—å `current_question_index > 0`
2. **–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—á–µ–Ω–Ω—ã–π + 1** - –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –Ω–æ –µ—Å—Ç—å –æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
3. **–ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å** - –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –Ω–∏ –æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã:
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è 5** ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å 6
- **–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –æ—Ç–≤–µ—á–µ–Ω—ã 1,2,3** ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å 4
- **–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –Ω–µ –æ—Ç–≤–µ—á–µ–Ω –Ω–∏ –æ–¥–∏–Ω** ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å 1

### –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –∏–∑ –º–µ–Ω—é

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### useMobileTest Hook
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `current_question_index` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `saveCurrentPosition`
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ —Ö—É–∫–∞

### EnhancedMobileTestTakingView
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `restoreProgress`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ `handleNext`, `handlePrevious`, `handleQuestionSelect`

### MobileTestTakingView
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `restoreProgress`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ `handleNext`, `handlePrevious`, `handleQuestionSelect`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü–æ–∑–∏—Ü–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –≤ –ë–î
- ‚ùå –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–ª –º–µ—Å—Ç–æ, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ
- ‚úÖ –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
- ‚úÖ Fallback –Ω–∞ –ª–æ–≥–∏–∫—É –æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. **–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞**: –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤, –∑–∞–∫—Ä—ã—Ç—å
2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç, –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–∏**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–∫—Ä—ã–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å
4. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: –ü–µ—Ä–µ–π—Ç–∏ –∫ –¥—Ä—É–≥–æ–º—É –≤–æ–ø—Ä–æ—Å—É, –∑–∞–∫—Ä—ã—Ç—å, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –ï—Å–ª–∏ –±—ã–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å–µ 5 ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å 5
- –ï—Å–ª–∏ –æ—Ç–≤–µ—á–µ–Ω—ã –≤–æ–ø—Ä–æ—Å—ã 1,2,3 ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å 4
- –ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–µ–Ω –Ω–∏ –æ–¥–∏–Ω ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å 1

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–ø–æ–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ 0)
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚úÖ –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç –±–∞–ª–ª–æ–≤ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞

–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –ø–æ–∑–∏—Ü–∏—è –≤ —Ç–µ—Å—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è. üì±‚ú®
